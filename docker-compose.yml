services:
  surrealdb:
    image: surrealdb/surrealdb:v2.6.2
    container_name: summer-surrealdb
    restart: unless-stopped
    user: '1000:1000'
    ports:
      - '8001:8000'
    volumes:
      - /home/brian/summer-data:/data
    command: start --log info --bind 0.0.0.0:8000 --unauthenticated --allow-all file:/data
    healthcheck:
      test: [CMD, /surreal, isready]
      interval: 2s
      timeout: 5s
      retries: 10
      start_period: 5s
    networks:
      - summer-network

  summer:
    build: .
    container_name: summer-app
    restart: unless-stopped
    ports:
      - '3000:3000'
    depends_on:
      surrealdb:
        condition: service_healthy
    networks:
      - summer-network
    environment:
      - NODE_ENV=production
      - SURREALDB_URL=http://surrealdb:8000
      - SURREALDB_NAMESPACE=summer
      - SURREALDB_DATABASE=summer

volumes:
  surrealdb-data:
    name: summer-surrealdb-data

networks:
  summer-network:
    name: summer-network
